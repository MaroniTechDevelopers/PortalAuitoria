<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastro de Auditores - Grupo Maroni</title>
    <link rel="stylesheet" href="assets/style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ96j40QY8I3yq8D86sY9bE40X3f48K4m4sA92A6lK41d2L4t5y4t4t8t4t8w=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="assets/cadastros.css" />
  </head>
  <body class="body-clientes">
  <header class="height-header d-flex m-0 container-color b-shadow">
      <button class="menu-icon" id="menuToggle">
        <img src="images/menu icon.png" alt="Menu Icon" class="menu-icon-img" />
      </button>
      <div class="div-h-form">
        <a href="index.html">
          <img src="images/LogoMaroni.png" alt="LogoMaroni" />
        </a>
      </div>
    </header>

    <!-- Overlay para fechar a sidebar -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <img src="images/LogoMaroni.png" alt="LogoMaroni" class="sidebar-logo" />
        <a href="#" class="close-btn" id="closeBtn">&times;</a>
    </div>
    <nav class="sidebar-nav">
        <a href="home.html" class="active">
            <i class="fas fa-home"></i>Menu Inicial
        </a>
        <a href="#" id="dropdownCadastro" class="has-dropdown">
            <i class="fas fa-database"></i>Cadastros
        </a>
        <div class="dropdown-container" id="dropdownContainer">
            <a href="Clientes.html"> <i class="fas fa-users"></i>Clientes </a>
            <a href="Auditor.html">
            <i class="fas fa-user-check"></i>Auditores
            </a>
        </div>
        <a href="#"> <i class="fas fa-chart-bar"></i>Dashboards </a>
        <a href="#"> <i class="fas fa-headset"></i>Suporte </a>
        <!-- Novo item adicionado -->
        <a href="Historico.html"> 
            <i class="fas fa-file-alt"></i>Histórico de Relatórios
        </a>
    </nav>
    </div>

      <div class="main-card">
    <div class="header-card">
     <h2>Cadastro de Auditores</h2>
    </div>
    <form class="form-grid-clientes" id="formCadastro">
     <div class="form-group full-width">
      <label for="nome">Nome</label>
      <input
       type="text"
       id="nome"
       name="nome"
       placeholder="Digite o nome do auditor"
       required
      />
     </div>
     <div class="form-group full-width">
      <label for="setor">Setor</label>
      <input
       type="text"
       id="setor"
       name="setor"
       placeholder="Digite o setor do auditor"
       required
      />
     </div>
     <div class="form-group">
      <label for="cpf">CPF</label>
      <input
       type="text"
       id="cpf"
       name="cpf"
       placeholder="000.000.000-00"
       required
      />
     </div>
     <div class="form-group">
      <label for="situacao">Situação</label>
      <select id="situacao" name="situacao">
       <option value="ativo">Ativo</option>
       <option value="inativo">Inativo</option>
      </select>
     </div>
     <div class="form-action">
      <button type="submit" class="btn-submit">Cadastrar</button>
     </div>
    </form>
   </div>

      <div class="main-card mt-20">
    <div class="header-card">
     <h2>Consulta de Auditores</h2>
    </div>
    <form class="form-grid-clientes" id="formConsulta">
     <div class="form-group full-width">
      <label for="consulta-auditor">Buscar auditor por nome ou CPF</label>
      <input
       type="text"
       id="consulta-auditor"
       name="consulta-auditor"
       placeholder="Nome ou CPF do auditor"
      />
     </div>
     <div class="form-action">
      <button type="button" class="btn-submit" id="btnConsultar">Consultar</button>
      <button type="button" class="btn-submit" id="btnLimpar" style="margin-left: 10px; background: linear-gradient(to right, #95a5a6, #7f8c8d);">Limpar</button>
     </div>
    </form>

    <h3>Auditores Cadastrados</h3>
    <div class="table-container">
     <table id="tabela-auditores">
      <thead>
       <tr>
        <th>Nome do auditor</th>
        <th>Setor</th>
        <th>CPF do auditor</th>
        <th>Situação</th>
        <th>Ações</th>
       </tr>
     </thead>
     <tbody>
      <tr>
       <td colspan="5" class="empty-row">Nenhum auditor cadastrado</td>
      </tr>
     </tbody>
    </table>
   </div>
  </main>
  
  <!-- Notificação -->
  <div class="notification" id="notification"></div>

  <!-- Modal de Edição -->
  <div class="modal" id="modalEdicao" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 3000; justify-content: center; align-items: center;">
    <div style="background: white; padding: 25px; border-radius: 12px; width: 90%; max-width: 500px; box-shadow: 0 5px 25px rgba(0,0,0,0.2);">
      <h2 style="margin-top: 0;">Editar Auditor</h2>
      <form id="formEdicao">
        <input type="hidden" id="edit-id">
        <div class="form-group full-width">
          <label for="edit-nome">Nome</label>
          <input type="text" id="edit-nome" required>
        </div>
        <div class="form-group full-width">
          <label for="edit-setor">Setor</label>
          <input type="text" id="edit-setor" required>
        </div>
        <div class="form-group">
          <label for="edit-cpf">CPF</label>
          <input type="text" id="edit-cpf" required>
        </div>
        <div class="form-group">
          <label for="edit-situacao">Situação</label>
          <select id="edit-situacao">
            <option value="ativo">Ativo</option>
            <option value="inativo">Inativo</option>
          </select>
        </div>
        <div class="form-action">
          <button type="submit" class="btn-submit">Salvar</button>
          <button type="button" class="btn-submit" id="btnCancelarEdicao" style="margin-left: 10px; background: linear-gradient(to right, #95a5a6, #7f8c8d);">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

 </body>
 <script src="scripts/home.js"></script>
 <script>
    // Armazenamento de dados (simulando um banco de dados)
    let auditores = JSON.parse(localStorage.getItem('auditores')) || [];
    let editingId = null;

    // Elementos DOM
    const formCadastro = document.getElementById('formCadastro');
    const formConsulta = document.getElementById('formConsulta');
    const formEdicao = document.getElementById('formEdicao');
    const btnConsultar = document.getElementById('btnConsultar');
    const btnLimpar = document.getElementById('btnLimpar');
    const btnCancelarEdicao = document.getElementById('btnCancelarEdicao');
    const tabela = document.getElementById('tabela-auditores');
    const modalEdicao = document.getElementById('modalEdicao');
    const notification = document.getElementById('notification');

    // Máscara para CPF
    document.getElementById('cpf').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 11) value = value.slice(0, 11);
      
      if (value.length > 9) {
        value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
      } else if (value.length > 6) {
        value = value.replace(/(\d{3})(\d{3})(\d+)/, '$1.$2.$3');
      } else if (value.length > 3) {
        value = value.replace(/(\d{3})(\d+)/, '$1.$2');
      }
      
      e.target.value = value;
    });

    // Máscara para CPF no modal de edição
    document.getElementById('edit-cpf').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 11) value = value.slice(0, 11);
      
      if (value.length > 9) {
        value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
      } else if (value.length > 6) {
        value = value.replace(/(\d{3})(\d{3})(\d+)/, '$1.$2.$3');
      } else if (value.length > 3) {
        value = value.replace(/(\d{3})(\d+)/, '$1.$2');
      }
      
      e.target.value = value;
    });

    // Função para mostrar notificação
    function showNotification(message, type = 'success') {
      notification.textContent = message;
      notification.className = `notification ${type} show`;
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // Função para gerar ID único
    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }

    // Função para atualizar a tabela
    function updateTable(filteredAuditores = null) {
      const tbody = tabela.querySelector('tbody');
      const data = filteredAuditores || auditores;
      
      tbody.innerHTML = '';
      
      if (data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="empty-row">Nenhum auditor cadastrado</td></tr>';
        return;
      }
      
      data.forEach(auditor => {
        const tr = document.createElement('tr');
        
        tr.innerHTML = `
          <td>${auditor.nome}</td>
          <td>${auditor.setor}</td>
          <td>${auditor.cpf}</td>
          <td class="${auditor.situacao === 'ativo' ? 'status-ativo' : 'status-inativo'}">${auditor.situacao.charAt(0).toUpperCase() + auditor.situacao.slice(1)}</td>
          <td>
            <button class="btn-action btn-edit" data-id="${auditor.id}"><i class="fas fa-edit"></i></button>
            <button class="btn-action btn-delete" data-id="${auditor.id}"><i class="fas fa-trash"></i></button>
          </td>
        `;
        
        tbody.appendChild(tr);
      });
      
      // Adicionar event listeners para os botões de ação
      document.querySelectorAll('.btn-edit').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const id = e.currentTarget.getAttribute('data-id');
          editAuditor(id);
        });
      });
      
      document.querySelectorAll('.btn-delete').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const id = e.currentTarget.getAttribute('data-id');
          deleteAuditor(id);
        });
      });
    }

    // Função para cadastrar auditor
    function addAuditor(auditor) {
      auditor.id = generateId();
      auditores.push(auditor);
      localStorage.setItem('auditores', JSON.stringify(auditores));
      updateTable();
      showNotification('Auditor cadastrado com sucesso!');
    }

    // Função para editar auditor
    function editAuditor(id) {
      const auditor = auditores.find(a => a.id === id);
      if (!auditor) return;
      
      editingId = id;
      document.getElementById('edit-id').value = id;
      document.getElementById('edit-nome').value = auditor.nome;
      document.getElementById('edit-setor').value = auditor.setor;
      document.getElementById('edit-cpf').value = auditor.cpf;
      document.getElementById('edit-situacao').value = auditor.situacao;
      
      modalEdicao.style.display = 'flex';
    }

    // Função para salvar edição do auditor
    function saveEditedAuditor(auditorData) {
      const index = auditores.findIndex(a => a.id === editingId);
      if (index === -1) return;
      
      auditores[index] = { ...auditorData, id: editingId };
      localStorage.setItem('auditores', JSON.stringify(auditores));
      updateTable();
      showNotification('Auditor atualizado com sucesso!');
      
      modalEdicao.style.display = 'none';
      editingId = null;
    }

    // Função para excluir auditor
    function deleteAuditor(id) {
      if (!confirm('Tem certeza que deseja excluir este auditor?')) return;
      
      auditores = auditores.filter(a => a.id !== id);
      localStorage.setItem('auditores', JSON.stringify(auditores));
      updateTable();
      showNotification('Auditor excluído com sucesso!');
    }

    // Função para consultar auditores
    function searchAuditors(term) {
      if (!term.trim()) {
        updateTable();
        return;
      }
      
      const filtered = auditores.filter(a => 
        a.nome.toLowerCase().includes(term.toLowerCase()) || 
        a.cpf.includes(term)
      );
      
      updateTable(filtered);
      
      if (filtered.length === 0) {
        showNotification('Nenhum auditor encontrado com os critérios de busca.', 'error');
      }
    }

    // Event Listeners
    formCadastro.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const auditor = {
        nome: document.getElementById('nome').value,
        setor: document.getElementById('setor').value,
        cpf: document.getElementById('cpf').value,
        situacao: document.getElementById('situacao').value
      };
      
      addAuditor(auditor);
      formCadastro.reset();
    });

    btnConsultar.addEventListener('click', function() {
      const term = document.getElementById('consulta-auditor').value;
      searchAuditors(term);
    });

    btnLimpar.addEventListener('click', function() {
      document.getElementById('consulta-auditor').value = '';
      updateTable();
    });

    formEdicao.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const auditorData = {
        nome: document.getElementById('edit-nome').value,
        setor: document.getElementById('edit-setor').value,
        cpf: document.getElementById('edit-cpf').value,
        situacao: document.getElementById('edit-situacao').value
      };
      
      saveEditedAuditor(auditorData);
    });

    btnCancelarEdicao.addEventListener('click', function() {
      modalEdicao.style.display = 'none';
      editingId = null;
    });

    // Fechar modal clicando fora dele
    modalEdicao.addEventListener('click', function(e) {
      if (e.target === modalEdicao) {
        modalEdicao.style.display = 'none';
        editingId = null;
      }
    });

    // Inicializar a tabela
    updateTable();
 </script>
</html>
